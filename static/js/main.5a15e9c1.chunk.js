(this["webpackJsonpcollage-editor"]=this["webpackJsonpcollage-editor"]||[]).push([[0],{103:function(e,t,n){},125:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(14),i=n.n(o),c=(n(103),n(7)),u=n(12),l=n(20),s=n.n(l),d=n(27),f=n(3),m=n(2),g=n(72),b=n.n(g),h=n(22),p=n(58),v=Object(p.a)({board:{position:"fixed",left:0,top:0,height:"calc(100% - 56px)",width:"100%",touchAction:"none"},"@media (min-width: 600px)":{board:{height:"calc(100% - 64px)"}}});function x(){return(x=Object(d.a)(s.a.mark((function e(t,n,r){var a,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.parentElement,o=a.getBoundingClientRect(),i=r||new h.a.Box(o.left,o.top,o.right,o.bottom),60,i.xmin-=60,i.xmax+=60,i.ymin-=60,i.ymax+=60,t.pause(),t.resume(),t.showRectangle({left:i.xmin,right:i.xmax,top:i.ymin,bottom:i.ymax,height:i.ymax-i.ymin,width:i.xmax-i.xmin}),t.moveBy(0,0,!0);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=Object(r.forwardRef)((function(e,t){var n=e.motionActive,o=void 0===n||n,i=e.backgroundColor,c=void 0===i?"#ffffff":i,l=e.onTransformChanged,s=e.onBackgroundClicked,d=e.children,f=Object(r.useRef)(null),g=Object(r.useRef)(null),h=Object(r.useRef)(null),p=Object(r.useState)(!1),y=Object(m.a)(p,2),O=y[0],E=y[1];Object(r.useImperativeHandle)(t,(function(){return{resetZoom:function(e){f.current&&h.current&&function(e,t,n){x.apply(this,arguments)}(f.current,h.current,e)}}}));var j=Object(r.useCallback)((function(e){h.current=e,f.current=b()(e,{onTouch:function(e){var t=f.current.getTransform();g.current=Object(u.a)({},t)},disableKeyboardInteraction:!0}),E(!0)}),[]);Object(r.useEffect)((function(){if(l&&O){var e=f.current;e.on("transform",(function(t){var n=e.getTransform();l(Object(u.a)({},n))}))}}),[O,l]),Object(r.useEffect)((function(){f.current&&(o?f.current.resume():f.current.pause())}),[o,f]);var w=v(),k=function(e){if(e.target===e.currentTarget){var t=g.current,n=f.current.getTransform();t&&n&&t.x===n.x&&t.y===n.y&&t.scale===n.scale&&(null===s||void 0===s||s())}},C={};return c&&(C.backgroundColor=c),a.a.createElement("div",{className:w.board,style:C,onMouseDown:function(e){var t=f.current.getTransform();g.current=Object(u.a)({},t)},onMouseUp:k,onTouchEnd:k},a.a.createElement("div",{ref:j},d))})),O=n(74),E=n.n(O),j=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],w=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];function k(e){for(var t=0,n=0;;){if(e(t,n))return[t,n];0===t?(t=n+1,n=0):(t-=1,n+=1)}}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||k(e),r=[],a=n[0],o=n[1],i=0,c=0,u=NaN,l=NaN,s=0;do{s=0,e(a-1,o-1)&&(s+=1),e(a,o-1)&&(s+=2),e(a-1,o)&&(s+=4),e(a,o)&&(s+=8),6===s?(i=-1===l?-1:1,c=0):9===s?(i=0,c=1===u?-1:1):(i=j[s],c=w[s]),i!==u&&c!==l&&(r.push({x:a,y:o}),u=i,l=c),a+=i,o+=c}while(n[0]!==a||n[1]!==o);return r}var S={},R=function(){var e=Object(d.a)(s.a.mark((function e(t,n){var r,a,o,i,c,u,l,d,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=S[t])){e.next=3;break}return e.abrupt("return",r);case 3:return a=new Promise((function(e,n){var r=new Image;r.crossOrigin="anonymous",r.onload=function(t){e(r)},r.onerror=function(e){n("Could not load image from ".concat(t,"."))},r.src=t})),e.next=6,a;case 6:return o=e.sent,i=n.width=o.width,c=n.height=o.height,(u=n.getContext("2d")).clearRect(0,0,n.width,n.height),u.drawImage(o,0,0),l=u.getImageData(0,0,n.width,n.height).data,d=C((function(e,t){return l[4*(t*i+e)+3]>99})),f={width:i,height:c,boundingPoints:d,dataUrl:n.toDataURL()},s=f,S[t]=s,e.abrupt("return",f);case 18:case"end":return e.stop()}var s}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(e){var t=[];return e.boundingPoints.forEach((function(e){return t.push("".concat(e.x,"px ").concat(e.y,"px"))})),t.join(",")},P=function(e){var t=[];return e.boundingPoints.forEach((function(e){return t.push("".concat(e.x,",").concat(e.y))})),t.join(" ")},U=Object(p.a)({container:{display:"inline-block",position:"absolute",cursor:"pointer"},svgEntity:{left:0,top:0}}),N=a.a.memo((function(e){var t=e.url,n=e.canvas,o=e.initialX,i=void 0===o?0:o,c=e.initialY,l=void 0===c?0:c,f=e.rotate,g=void 0===f?0:f,b=e.glued,p=e.onInitialStateAvailable,v=e.onMovingStart,x=e.onMovingEnd,y=e.onMove,O=e.onMouseEnter,j=e.onMouseLeave,w=e.onSelect,k=e.dragScale,C=void 0===k?1:k,S=U(),N=Object(r.useState)({width:0,height:0,style:{}}),T=Object(m.a)(N,2),M=T[0],B=T[1],L=Object(r.useState)({width:0,height:0,href:""}),A=Object(m.a)(L,2),F=A[0],D=A[1],Y=Object(r.useState)(""),z=Object(m.a)(Y,2),X=z[0],Z=z[1],G=Object(r.useRef)(null),H=Object(r.useRef)({left:i,right:0,top:l,bottom:0}),J=Object(r.useRef)(new h.a.Polygon);Object(r.useEffect)((function(){(function(){var e=Object(d.a)(s.a.mark((function e(){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t,n);case 2:r=e.sent,a=I(r),B({width:r.width,height:r.height}),D({width:r.width,height:r.height,href:r.dataUrl}),Z("polygon(".concat(a,")")),G.current={url:t,imageSize:{width:r.width,height:r.height},rawPolygon:new h.a.Polygon(r.boundingPoints.map((function(e){return h.a.point(e.x,e.y)}))),borderPoints:P(r)},J.current=W(G.current.rawPolygon,H.current,g),null===p||void 0===p||p(Object(u.a)(Object(u.a)({},G.current),{},{inUse:!0,rotate:g,boundingRect:H.current,transformedPolygon:J.current}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t,n,p]);var _=function(e,t){var n=G.current.imageSize,r={left:i+e.x,top:l+e.y,right:i+e.x+n.width,bottom:l+e.y+n.height},a=J.current;return t&&(a=W(G.current.rawPolygon,r,g)),Object(u.a)(Object(u.a)({},G.current),{},{inUse:!0,rotate:g,boundingRect:r,transformedPolygon:a})},W=function(e,t,n){var r=n*Math.PI/180,a=e.box.center,o=(new h.a.Matrix).translate(t.left,t.top).translate(a.x,a.y).rotate(r).translate(-a.x,-a.y);return e.transform(o)},K=function(){null===O||void 0===O||O(Object(u.a)(Object(u.a)({},G.current),{},{inUse:!0,rotate:g,boundingRect:H.current,transformedPolygon:J.current}))},q=function(){null===j||void 0===j||j(Object(u.a)(Object(u.a)({},G.current),{},{inUse:!0,rotate:g,boundingRect:H.current,transformedPolygon:J.current}))};return a.a.createElement(E.a,{scale:C,positionOffset:{x:i,y:l},onStart:function(e,t){return function(e){if(b)return!1;null===v||void 0===v||v(_(e,!1))}(t)},onStop:function(e,t){return function(e){var t=_(e,!0);null===x||void 0===x||x(t),H.current=t.boundingRect,J.current=t.transformedPolygon}(t)},onDrag:function(e,t){return n=t,void(null===y||void 0===y||y(_(n,!1)));var n},onMouseDown:function(){null===w||void 0===w||w(Object(u.a)(Object(u.a)({},G.current),{},{inUse:!0,rotate:g,boundingRect:H.current,transformedPolygon:J.current}))}},a.a.createElement("div",null,a.a.createElement("div",{style:{clipPath:X,transform:"rotate(".concat(g,"deg)")},className:S.container,onMouseEnter:function(){return K()},onMouseLeave:function(){return q()}},a.a.createElement("svg",Object.assign({className:S.svgEntity},M),a.a.createElement("image",F)))))})),T=n(83),M=n(145),B=n(161),L=function(){var e=Object(d.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL("workshop.json",t).href,e.prev=1,e.next=4,fetch(n,{method:"GET",mode:"no-cors"});case 4:if(!(r=e.sent).ok){e.next=13;break}return e.next=8,r.json();case 8:if((a=e.sent)&&a.name&&a.images instanceof Array){e.next=11;break}throw new Error("Workshop data is not correctly formatted.");case 11:return a.images=a.images.map((function(e){return new URL(e,t).href})),e.abrupt("return",a);case 13:throw new Error("Could not load workshop. Response from server: ".concat(r.status," ").concat(r.statusText));case 16:throw e.prev=16,e.t0=e.catch(1),new Error("Could not load workshop; ".concat(e.t0));case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}(),A=Object(M.a)((function(e){var t=e.palette;return{selectionBorderSvg:{position:"absolute",pointerEvents:"none"},selectionBorderPolygon:{fill:"none",strokeWidth:"3px",strokeLinejoin:"round",stroke:function(e){return"primary"===e.color?t.primary.main:t.primary.light}}}})),F=function(e){var t=e.img,n=e.color,r=A({img:t,color:n});return a.a.createElement("svg",{className:r.selectionBorderSvg,width:t.imageSize.width,height:t.imageSize.height,style:{left:t.boundingRect.left,top:t.boundingRect.top,transform:"rotate(".concat(t.rotate,"deg)")}},a.a.createElement("polygon",{className:r.selectionBorderPolygon,points:t.borderPoints}))},D=Object(M.a)((function(){return{selectionLayer:{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:"none"}}})),Y=function(e){var t=e.hoverImage,n=e.selectedImage,r=D(),o=n?a.a.createElement(F,{color:"primary",img:n}):null,i=t&&t.url!==(null===n||void 0===n?void 0:n.url)?a.a.createElement(F,{color:"secondary",img:t}):null;return a.a.createElement("div",{className:r.selectionLayer},o,i)},z=n(85),X=n(147),Z=n(148),G=n(149),H=n(150),J=n(151),_=n(152),W=n(163),K=n(153),q=n(164),Q=n(162),V=n(154),$=n(155),ee=n(156),te=n(157),ne=n(158),re=n(159),ae=n(160),oe=n(75),ie=n.n(oe),ce=n(76),ue=n.n(ce),le=n(81),se=n.n(le),de=n(79),fe=n.n(de),me=n(63),ge=n.n(me),be=n(78),he=n.n(be),pe=n(77),ve=n.n(pe),xe=n(80),ye=n.n(xe),Oe=n(36),Ee=n(146),je=Object(M.a)((function(e){var t=e.palette;return{bar:{top:"auto;",bottom:0,boxShadow:"0px -4px 5px 0px rgba(0, 0, 0, 0.21)",overflow:"hidden"},barTitle:{paddingRight:"10px",paddingLeft:"3em",background:"url('/logo192.png')",backgroundSize:"contain",backgroundRepeat:"no-repeat"},barTitleLarge:{paddingRight:"10px",paddingLeft:"5em",background:"url('/logo192.png')",backgroundSize:"contain",backgroundRepeat:"no-repeat"},divider:{marginLeft:"10px"},buttonContainer:{marginLeft:"10px"},boxGrid:{height:"600px"},boxImage:{},grow:{flexGrow:1},swappableSection:{position:"relative",alignSelf:"stretch",alignItems:"center",display:"flex",flexGrow:1},swappableSet:{position:"absolute",left:0},imgBoundingBox:{backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",height:"100%",width:"100%",boxSizing:"border-box",borderColor:"transparent",cursor:"pointer","&:active":{borderColor:t.primary.main},"&:focus":{borderColor:t.primary.main},"&:hover":{borderColor:t.primary.main}},imgTileBar:{background:"none",padding:"5px",boxSizing:"content-box"},imgActionUsePhoto:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 100%)",color:"white"},boxDrawer:{width:"100%",height:"100%",left:0,top:0,padding:"10px",userSelect:"none"},colorPicker:{visibility:"hidden",width:"0px"}}})),we=a.a.memo((function(e){var t,n=e.activeImage,o=e.workshopName,i=e.boardBackgroundColor,c=e.allImages,u=e.onZoomToFit,l=e.onUpOne,s=e.onDownOne,d=e.onRemoveImage,f=e.onUseImage,g=e.onBackgroundColorChange,b=e.onDeleteAll,h=e.onHeadingClicked,p=je(),v=Object(r.useState)(!1),x=Object(m.a)(v,2),y=x[0],O=x[1],E=Object(r.useState)(!1),j=Object(m.a)(E,2),w=j[0],k=j[1],C=Object(Oe.a)(),S=Object(Ee.a)(C.breakpoints.up("sm")),R=Object(r.useRef)(null),I=function(e){return function(t){(!t||"keydown"!==t.type||"Tab"!==t.key&&"Shift"!==t.key)&&O(e)}},P=function(e){null===f||void 0===f||f(e),O(!1)},U=function(e){k(!1),e&&(null===b||void 0===b||b())};return t=o&&S?a.a.createElement(a.a.Fragment,null,a.a.createElement(z.a,{variant:"h6"},o),a.a.createElement(z.a,{variant:"subtitle2"},"CollageIT")):a.a.createElement(z.a,{variant:"h6"},"CollageIT"),a.a.createElement(a.a.Fragment,null,a.a.createElement(X.a,null),a.a.createElement(Z.a,{className:p.bar,color:"primary",elevation:16,position:"fixed"},a.a.createElement(G.a,null,a.a.createElement("div",{className:S?p.barTitleLarge:p.barTitle,onClick:h},t),a.a.createElement(H.a,{className:p.divider,orientation:"vertical",flexItem:!0}),a.a.createElement("div",{className:p.swappableSection},a.a.createElement("div",{className:p.swappableSet},a.a.createElement(J.a,{direction:"up",in:null!==n,mountOnEnter:!0,unmountOnExit:!0},a.a.createElement("div",null,a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:l,title:"Move Image Up"},a.a.createElement(ie.a,null)),a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:s,title:"Move Image Down"},a.a.createElement(ue.a,null)),a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:d,title:"Remove Image"},a.a.createElement(ve.a,null))))),a.a.createElement("div",{className:p.swappableSet},a.a.createElement(J.a,{direction:"down",in:null===n,mountOnEnter:!0,unmountOnExit:!0},a.a.createElement("div",null,a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:I(!0),title:"Add New Image"},a.a.createElement(ge.a,null)),a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:function(){var e;null===(e=R.current)||void 0===e||e.click()},title:"Change Background Colour"},a.a.createElement(he.a,null)),a.a.createElement("input",{className:p.colorPicker,type:"color",ref:R,value:null!==i&&void 0!==i?i:"#FFFFFF",onChange:function(e){return null===g||void 0===g?void 0:g(e.target.value)}}),a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:u,title:"Zoom To Fit"},a.a.createElement(fe.a,null)),a.a.createElement(_.a,{edge:"end",color:"inherit",onClick:function(){return k(!0)},title:"Remove All Images"},a.a.createElement(ye.a,null)))))))),a.a.createElement(W.a,{open:y,anchor:"bottom",onOpen:I(!0),onClose:I(!1)},a.a.createElement(Z.a,{position:"static",color:"primary",onClick:I(!1)},a.a.createElement(G.a,null,a.a.createElement(z.a,{variant:"h4"},a.a.createElement(ge.a,null)," Box"))),a.a.createElement("div",{className:p.boxDrawer},a.a.createElement(K.a,{className:p.boxGrid,cellHeight:160,cols:S?6:2,spacing:10},c.filter((function(e){return!e.inUse})).map((function(e){return a.a.createElement(q.a,{key:e.url,cols:1},a.a.createElement(Q.a,{className:p.imgBoundingBox,style:{backgroundImage:"url(".concat(e.url,")")},border:2,onDoubleClick:function(){return P(e.url)}},a.a.createElement(V.a,{titlePosition:"top",actionIcon:a.a.createElement(_.a,{"aria-label":"use image",className:p.imgActionUsePhoto,onClick:function(){return P(e.url)}},a.a.createElement(se.a,null)),actionPosition:"right",className:p.imgTileBar})))}))))),a.a.createElement($.a,{open:w,onClose:function(){return U(!1)}},a.a.createElement(ee.a,null,"Delete All Images?"),a.a.createElement(te.a,null,a.a.createElement(ne.a,null,"This will remove all your images from the collage and start again. Are you sure?")),a.a.createElement(re.a,null,a.a.createElement(ae.a,{onClick:function(){return U(!1)},color:"primary",autoFocus:!0},"No, I'm still using them!"),a.a.createElement(ae.a,{onClick:function(){return U(!0)},color:"primary"},"Yep, I'm sure, remove my images."))))})),ke=n(82),Ce=n.n(ke),Se=Object(M.a)((function(e){e.palette;return{rotator:{position:"absolute",cursor:"grab",pointerEvents:"all",touchAction:"none"}}})),Re=function(e){var t=e.center,n=Se();return a.a.createElement("svg",Object.assign({className:n.rotator,width:50,height:50,style:{left:t.x-25,top:t.y-25}},e),a.a.createElement(Ce.a,null))},Ie=Object(M.a)((function(){return{overlayLayer:function(e){return{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:e.isRotateActive?"auto":"none",cursor:e.isRotateActive?"grabbing":"cursor",touchAction:"none"}}}})),Pe=function(e){var t,n,o,i,c,u=e.selectedImage,l=e.currentBoardTransform,s=e.onRotationChanged,d=e.onRotationEnded,f=Object(r.useState)(!1),g=Object(m.a)(f,2),b=g[0],p=g[1],v=Object(r.useRef)(0),x=Object(r.useRef)(0),y=Object(r.useState)(-1),O=Object(m.a)(y,2),E=O[0],j=O[1],w=Ie({isRotateActive:b});if(u){var k=new h.a.Box(u.boundingRect.left,u.boundingRect.top,u.boundingRect.right,u.boundingRect.bottom),C=h.a.point(u.boundingRect.left+u.imageSize.width/2,u.boundingRect.top-100),S=u.rotate*Math.PI/180,R=C.rotate(S,k.center),I=l.x+R.x*l.scale,P=l.y+R.y*l.scale,U={x:l.x+k.center.x*l.scale,y:l.y+k.center.y*l.scale},N=function(e,t){var n=Math.atan2(e-U.x,t-U.y);return Math.round(n*(180/Math.PI)*-1+100)};t=a.a.createElement(Re,{center:{x:I,y:P},onMouseDown:function(e){v.current=N(e.pageX,e.pageY)-u.rotate,x.current=0,p(!0)},onTouchStart:function(e){-1===E&&(j(e.changedTouches[0].identifier),v.current=N(e.changedTouches[0].pageX,e.changedTouches[0].pageY)-u.rotate,x.current=0,p(!0))}}),b&&(n=function(e){var t=N(e.pageX,e.pageY)-v.current;x.current=t,s(u,t)},o=function(e){if(e.changedTouches[0].identifier===E){var t=e.changedTouches[0],n=N(t.pageX,t.pageY)-v.current;x.current=n,s(u,n),e.preventDefault()}},i=function(){d(u,x.current),p(!1)},c=function(e){e.changedTouches[0].identifier===E&&(d(u,x.current),p(!1),j(-1))})}return a.a.createElement("div",{className:w.overlayLayer,onMouseUp:i,onTouchEnd:c,onMouseLeave:i,onTouchMove:o,onMouseMove:n},t)},Ue=Object(T.a)({palette:{primary:{main:"#FF66B2",light:"#FF007F"}}}),Ne=Object(M.a)((function(e){return{computeCanvas:{visibility:"hidden",position:"fixed",left:-9999},selectionLayer:{position:"fixed",left:0,top:0,height:"100%",width:"100%",pointerEvents:"none"}}}));var Te=function(){var e="default";window.location.hash&&(e=window.location.hash.substring(1)||"default");var t=Ne(),n=Object(r.useRef)(null),o=Object(r.useRef)(null),i=Object(r.useRef)(),l=Object(r.useState)(""),g=Object(m.a)(l,2),b=g[0],p=g[1],v=Object(r.useState)("#ffffff"),x=Object(m.a)(v,2),O=x[0],E=x[1],j=Object(r.useState)([]),w=Object(m.a)(j,2),k=w[0],C=w[1],S=Object(r.useState)([]),R=Object(m.a)(S,2),I=R[0],P=R[1],U=Object(r.useState)((function(){return new URL(e+"/",window.location.href).href})),T=Object(m.a)(U,1)[0],M=Object(r.useState)(!0),A=Object(m.a)(M,2),F=A[0],D=A[1],z=Object(r.useState)(null),X=Object(m.a)(z,2),Z=X[0],G=X[1],H=Object(r.useState)(null),J=Object(m.a)(H,2),_=J[0],W=J[1],K=Object(r.useState)(null),q=Object(m.a)(K,2),Q=q[0],V=q[1],$=Object(r.useState)({x:0,y:0,scale:1}),ee=Object(m.a)($,2),te=ee[0],ne=ee[1],re=function(){var e,t,n,r=i.current,a=null,c=!0,u=Object(f.a)(r||[]);try{for(u.s();!(e=u.n()).done;){var l=e.value;if(null===l||void 0===l?void 0:l.inUse){var s=null===l||void 0===l?void 0:l.transformedPolygon.box;if(c)a=s,c=!1;else{var d=a.clone();s.xmin<d.xmin&&(d.xmin=s.xmin),s.ymin<d.ymin&&(d.ymin=s.ymin),s.xmax>d.xmax&&(d.xmax=s.xmax),s.ymax>d.ymax&&(d.ymax=s.ymax),a=d}}}}catch(m){u.e(m)}finally{u.f()}a?null===(t=o.current)||void 0===t||t.resetZoom(a):null===(n=o.current)||void 0===n||n.resetZoom()};Object(r.useEffect)((function(){var e=function(){return setTimeout(re,100)};return window.addEventListener("orientationchange",e),function(){return window.removeEventListener("orientationchange",e)}}),[]),Object(r.useEffect)((function(){(function(){var e=Object(d.a)(s.a.mark((function e(){var t,n,r,a,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L(T);case 3:t=e.sent,p(t.name),n=localStorage.getItem("data_".concat(T)),r=t.images.map((function(e){return{url:e,inUse:!1,initialX:0,initialY:0,rotate:0}})),a=r,n&&(o=JSON.parse(n))&&(E(o.backgroundColor),c=o.images.map((function(e){return{inUse:e.inUse,url:e.url,initialX:e.x,initialY:e.y,rotate:e.rotate}})),a=[],r.forEach((function(e){var t=c.find((function(t){return t.url===e.url}));t?(a.push(t),e.inUse=t.inUse):a.push({url:e.url,inUse:!1,initialX:0,initialY:0,rotate:0})}))),C(r),P(a),i.current=a.map((function(e){return{url:e.url,inUse:e.inUse,rotate:e.rotate,borderPoints:"",rawPolygon:new h.a.Polygon,transformedPolygon:new h.a.Polygon,boundingRect:{left:e.initialX,top:e.initialY,right:0,bottom:0},imageSize:{width:0,height:0}}})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}})()()}),[T]);var ae=Object(r.useCallback)((function(){if(T&&i.current){var e={backgroundColor:O,images:i.current.map((function(e){return{url:e.url,inUse:e.inUse,x:e.boundingRect.left,y:e.boundingRect.top,rotate:e.rotate}}))};localStorage.setItem("data_".concat(T),JSON.stringify(e))}}),[O,T]);Object(r.useEffect)((function(){ae()}),[O,I,T,ae]);var oe=Object(r.useCallback)((function(e){var t,n=i.current;if(n){var r=n.findIndex((function(t){return t&&t.url===e.url})),a=!(null===(t=n[r])||void 0===t?void 0:t.borderPoints);n[r]=Object(u.a)(Object(u.a)({},e),{},{inUse:n[r].inUse}),a&&-1===n.findIndex((function(e){return(null===e||void 0===e?void 0:e.inUse)&&!e.borderPoints}))&&re()}}),[]),ie=function(e){G(e)},ce=function(e){G(null)},ue=function(e){V(e)},le=function(e){D(!0),V(null),Z&&Z.url===e.url&&G(e),_&&_.url===e.url&&W(e),oe(e),ae()},se=function(e){W(e)},de=function(e,t){var n=h.a.BooleanOperations;if(e.transformedPolygon.box.not_intersect(t.transformedPolygon.box))return!1;if(e.transformedPolygon.intersect(t.transformedPolygon).length>0)return!0;var r=n.innerClip(e.transformedPolygon,t.transformedPolygon);return r[0].length>0||r[1].length>0},fe=function(e,t){var n=i.current;if(n){var r=n.findIndex((function(t){return(null===t||void 0===t?void 0:t.url)===e.url}));if(-1!==r){var a=n[r],o=t(r,a,n);if(o!==r){n.splice(r,1),o<r?o++:o--,n.splice(o,0,a);var u=Object(c.a)(I),l=u.splice(r,1);u.splice(o,0,l[0]),P(u)}}}},me=function(e,t,n){for(var r=e+1;r<n.length;r++){var a=n[r];if(a&&a.inUse&&de(a,t))return r+1}return e},ge=function(e,t,n){for(var r=e-1;r>=0;r--){var a=n[r];if(a&&a.inUse&&de(a,t))return r-1}return e},be=function(e,t){var n=k.findIndex((function(t){return t.url===e}));if(-1!==n&&k[n].inUse!==t){var r=Object(c.a)(k);r[n].inUse=t,C(r);var a=Object(c.a)(I),o=I.findIndex((function(t){return t.url===e}));if(-1!==o){var u=a[o];u.inUse=t,t&&(a.splice(o,1),a.push(u)),P(a);var l=i.current,s=l[o];s.inUse=t,t?(l.splice(o,1),l.push(s),re()):W(null)}else console.warn("Image in general list but not in ordered list.")}},he=Object(r.useCallback)((function(e){ne(e)}),[ne]);return a.a.createElement(B.a,{theme:Ue},a.a.createElement("div",{className:"App"},a.a.createElement(y,{ref:o,backgroundColor:O,motionActive:F,onTransformChanged:he,onBackgroundClicked:function(){return W(null)}},I.filter((function(e){return e.inUse})).map((function(e){return a.a.createElement(N,{canvas:n.current,url:e.url,key:e.url,glued:!1,initialX:e.initialX,initialY:e.initialY,rotate:e.rotate,dragScale:te.scale,onInitialStateAvailable:oe,onMovingStart:function(){return D(!1)},onMove:ue,onMouseEnter:ie,onMouseLeave:ce,onMovingEnd:le,onSelect:se})})),a.a.createElement(Y,{hoverImage:Z,selectedImage:null!==Q&&void 0!==Q?Q:_,key:"_selection"})),a.a.createElement(Pe,{selectedImage:null!==Q&&void 0!==Q?Q:_,currentBoardTransform:te,onRotationChanged:function(e,t){var n=Object(u.a)(Object(u.a)({},e),{},{rotate:t});oe(n),_&&_.url===n.url&&W(n);var r=Object(c.a)(I),a=r.findIndex((function(t){return t.url===e.url}));r[a].rotate=t,P(r)},onRotationEnded:function(e,t){var n=Object(u.a)(Object(u.a)({},e),{},{rotate:t});_&&_.url===n.url&&W(n),oe(n),ae()}}),a.a.createElement(we,{activeImage:_,boardBackgroundColor:O,workshopName:b,allImages:k,onZoomToFit:function(){return re()},onUpOne:function(){return fe(_,me)},onDownOne:function(){return fe(_,ge)},onRemoveImage:function(){return be(_.url,!1)},onUseImage:function(e){return be(e,!0)},onBackgroundColorChange:function(e){return E(e)},onDeleteAll:function(){C(k.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{inUse:!1})}))),P(I.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{inUse:!1})}))),i.current.forEach((function(e){e&&(e.inUse=!1)}))},onHeadingClicked:function(){return W(null)}}),a.a.createElement("canvas",{ref:n,className:t.computeCanvas})))};i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(Te,null)),document.getElementById("root"))},98:function(e,t,n){e.exports=n(125)}},[[98,1,2]]]);
//# sourceMappingURL=main.5a15e9c1.chunk.js.map